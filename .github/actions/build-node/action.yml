name: Build Node.js bindings
description: Builds NAPI-RS Node.js bindings for a specified target

inputs:
  target:
    description: Rust target triple (e.g., x86_64-unknown-linux-gnu)
    required: true
  use-cross:
    description: Whether to use cross for cross-compilation
    required: false
    default: "false"
  pack-tarball:
    description: Whether to pack the result as an npm tarball
    required: false
    default: "false"

outputs:
  binding-path:
    description: Path to the built .node binding file
    value: ${{ steps.build.outputs.binding-path }}
  tarball:
    description: Path to the packed tarball (if pack-tarball is true)
    value: ${{ steps.pack.outputs.tarball }}

runs:
  using: composite
  steps:
    - name: Build NAPI-RS bindings
      id: build
      shell: bash
      working-directory: crates/kreuzberg-node
      run: ../../scripts/ci/actions/build-node/build.sh "${{ inputs.target }}" "${{ inputs.use-cross }}"

    - name: Pack Node tarball
      if: inputs.pack-tarball == 'true'
      id: pack
      shell: bash
      run: scripts/ci/actions/build-node/pack.sh
