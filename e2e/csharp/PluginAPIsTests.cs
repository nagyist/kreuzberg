// Code generated by kreuzberg-e2e-generator. DO NOT EDIT.
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using Kreuzberg;
using Xunit;

namespace Kreuzberg.E2E.PluginApis;

/// <summary>
/// E2E tests for plugin/config/utility APIs.
///
/// Generated from plugin API fixtures.
/// To regenerate: cargo run -p kreuzberg-e2e-generator -- generate --lang csharp
/// </summary>
public class PluginAPIsTests
{
    // Configuration Tests

    // SKIPPED: config_discover - Environment.CurrentDirectory doesn't reliably affect FFI

    [Fact]
    public void ConfigFromFile()
    {
        var tmpDir = Path.Combine(Path.GetTempPath(), "kreuzberg-test-" + Guid.NewGuid());
        Directory.CreateDirectory(tmpDir);
        try
        {
            var configPath = Path.Combine(tmpDir, "test_config.toml");
            File.WriteAllText(configPath, "[chunking]\nmax_chars = 100\nmax_overlap = 20\n\n[language_detection]\nenabled = false\n");

            var config = KreuzbergClient.LoadExtractionConfigFromFile(configPath);
            Assert.NotNull(config.Chunking);
            Assert.Equal(100, config.Chunking.MaxChars);
            Assert.Equal(20, config.Chunking.MaxOverlap);
            Assert.NotNull(config.LanguageDetection);
            Assert.Equal(false, config.LanguageDetection.Enabled);
        }
        finally
        {
            Directory.Delete(tmpDir, true);
        }
    }

    // Document Extractor Management Tests

    [Fact]
    public void ExtractorsClear()
    {
        KreuzbergClient.ClearDocumentExtractors();
        var result = KreuzbergClient.ListDocumentExtractors();
        Assert.Empty(result);
    }

    [Fact]
    public void ExtractorsList()
    {
        var result = KreuzbergClient.ListDocumentExtractors();
        Assert.NotNull(result);
        Assert.All(result, item => Assert.IsType<string>(item));
    }

    [Fact]
    public void ExtractorsUnregister()
    {
        KreuzbergClient.UnregisterDocumentExtractor("nonexistent-extractor-xyz");
    }

    // Mime Utilities Tests

    [Fact]
    public void MimeDetectBytes()
    {
        var testBytes = System.Text.Encoding.UTF8.GetBytes("%PDF-1.4\\n");
        var result = KreuzbergClient.DetectMimeType(testBytes);
        Assert.Contains("pdf", result.ToLower());
    }

    [Fact]
    public void MimeDetectPath()
    {
        var tmpDir = Path.Combine(Path.GetTempPath(), "kreuzberg-test-" + Guid.NewGuid());
        Directory.CreateDirectory(tmpDir);
        try
        {
            var filePath = Path.Combine(tmpDir, "test.txt");
            File.WriteAllText(filePath, "Hello, world!");

            var result = KreuzbergClient.DetectMimeTypeFromPath(filePath);
            Assert.Contains("text", result.ToLower());
        }
        finally
        {
            Directory.Delete(tmpDir, true);
        }
    }

    [Fact]
    public void MimeGetExtensions()
    {
        var result = KreuzbergClient.GetExtensionsForMime("application/pdf");
        Assert.NotNull(result);
        Assert.Contains("pdf", result);
    }

    // Ocr Backend Management Tests

    [Fact]
    public void OcrBackendsClear()
    {
        KreuzbergClient.ClearOcrBackends();
        var result = KreuzbergClient.ListOcrBackends();
        Assert.Empty(result);
    }

    [Fact]
    public void OcrBackendsList()
    {
        var result = KreuzbergClient.ListOcrBackends();
        Assert.NotNull(result);
        Assert.All(result, item => Assert.IsType<string>(item));
    }

    [Fact]
    public void OcrBackendsUnregister()
    {
        KreuzbergClient.UnregisterOcrBackend("nonexistent-backend-xyz");
    }

    // Post Processor Management Tests

    [Fact]
    public void PostProcessorsClear()
    {
        KreuzbergClient.ClearPostProcessors();
    }

    [Fact]
    public void PostProcessorsList()
    {
        var result = KreuzbergClient.ListPostProcessors();
        Assert.NotNull(result);
        Assert.All(result, item => Assert.IsType<string>(item));
    }

    // Validator Management Tests

    [Fact]
    public void ValidatorsClear()
    {
        KreuzbergClient.ClearValidators();
        var result = KreuzbergClient.ListValidators();
        Assert.Empty(result);
    }

    [Fact]
    public void ValidatorsList()
    {
        var result = KreuzbergClient.ListValidators();
        Assert.NotNull(result);
        Assert.All(result, item => Assert.IsType<string>(item));
    }

}
